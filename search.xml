<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>rabbitmq学习</title>
    <url>/2020/01/31/rabbitmq%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h1 id="Springboot集成Rabbitmq"><a href="#Springboot集成Rabbitmq" class="headerlink" title="Springboot集成Rabbitmq"></a>Springboot集成Rabbitmq</h1><h2 id="1-基于Spring-Rabbit操作Rabbitmq"><a href="#1-基于Spring-Rabbit操作Rabbitmq" class="headerlink" title="1.基于Spring-Rabbit操作Rabbitmq"></a>1.基于Spring-Rabbit操作Rabbitmq</h2><blockquote>
<p>使用spring-boot-starter-amqp会自动添加spring-rabbit依赖<br>代码如下：</p>
<blockquote>
</blockquote>
</blockquote>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring‐boot‐starter‐amqp&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring‐boot‐starter‐test&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring‐boot‐starter‐logging&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h1 id="2-配置"><a href="#2-配置" class="headerlink" title="2.配置"></a>2.配置</h1><h2 id="1-配置application-yml文件"><a href="#1-配置application-yml文件" class="headerlink" title="1.配置application.yml文件"></a>1.配置application.yml文件</h2><blockquote>
<p>连接rabbitmq</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">server:</span><br><span class="line">port: <span class="number">44000</span></span><br><span class="line">spring:</span><br><span class="line">application:</span><br><span class="line">name: test‐rabbitmq‐producer</span><br><span class="line">rabbitmq:</span><br><span class="line">host: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">port: <span class="number">5672</span></span><br><span class="line">username: guest</span><br><span class="line">password: guest</span><br><span class="line">virtualHost: /</span><br></pre></td></tr></table></figure>
<h2 id="2-定义RabbitConfig类，配置Exchange、Queue、及绑定交换机。"><a href="#2-定义RabbitConfig类，配置Exchange、Queue、及绑定交换机。" class="headerlink" title="2.定义RabbitConfig类，配置Exchange、Queue、及绑定交换机。"></a>2.定义RabbitConfig类，配置Exchange、Queue、及绑定交换机。</h2><blockquote>
<p>以配置topics交换机为例</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//队列名称</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String QUEUE_INFORM_EMAIL = <span class="string">"queue_inform_email"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String QUEUE_INFORM_SMS = <span class="string">"queue_inform_sms"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXCHANGE_TOPICS_INFORM=<span class="string">"exchange_topics_inform"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ROUTINGKEY_EMAIL=<span class="string">"inform.#.email.#"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ROUTINGKEY_SMS=<span class="string">"inform.#.sms.#"</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//声明交换机</span></span><br><span class="line">    <span class="meta">@Bean</span>(EXCHANGE_TOPICS_INFORM)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Exchange <span class="title">EXCHANGE_TOPICS_INFORM</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//durable(true)持久化，消息队列重启后交换机仍然存在</span></span><br><span class="line">        <span class="keyword">return</span> ExchangeBuilder.topicExchange(EXCHANGE_TOPICS_INFORM).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//声明队列</span></span><br><span class="line">    <span class="meta">@Bean</span>(QUEUE_INFORM_EMAIL)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">QUEUE_INFORM_EMAIL</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(QUEUE_INFORM_EMAIL);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span>(QUEUE_INFORM_SMS)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">QUEUE_INFORM_SMS</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(QUEUE_INFORM_SMS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//绑定交换机和队列</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">BINGDING_QUEUE_INFORM_EMAIL</span><span class="params">(@Qualifier(QUEUE_INFORM_EMAIL)</span> Queue queue,</span></span><br><span class="line"><span class="function">                                               @<span class="title">Qualifier</span><span class="params">(EXCHANGE_TOPICS_INFORM)</span> Exchange exchange) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queue).to(exchange).with(ROUTINGKEY_EMAIL).noargs();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">BINGDING_QUEUE_INFORM_SMS</span><span class="params">(@Qualifier(QUEUE_INFORM_EMAIL)</span> Queue queue,</span></span><br><span class="line"><span class="function">                                               @<span class="title">Qualifier</span><span class="params">(EXCHANGE_TOPICS_INFORM)</span> Exchange exchange) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queue).to(exchange).with(ROUTINGKEY_SMS).noargs();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-SpringBootTest单元测试"><a href="#3-SpringBootTest单元测试" class="headerlink" title="3.SpringBootTest单元测试"></a>3.SpringBootTest单元测试</h2><blockquote>
<p>代码如下</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">Producer04_topics_springboot</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用RabbitTemplate来发送消息</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSendEmail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String message=<span class="string">"send email to user"</span>;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 参数：</span></span><br><span class="line"><span class="comment">         * 1.交换机名称</span></span><br><span class="line"><span class="comment">         * 2.routingkey</span></span><br><span class="line"><span class="comment">         * 3.消息内容</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        rabbitTemplate.convertAndSend(RabbitmqConfig.EXCHANGE_TOPICS_INFORM,<span class="string">"inform.email"</span>,message);</span><br><span class="line">        System.out.println(<span class="string">"Send Message is:'"</span> +message+<span class="string">"'"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="报错"><a href="#报错" class="headerlink" title="报错"></a>报错</h2><blockquote>
<p>因为之前已经开启并且持久化了一个相同名字的交换机“exchange_topics_inform”，springboot启动就报了io异常</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">at org.springframework.amqp.rabbit.support.RabbitExceptionTranslator.convertRabbitAccessException(Ra</span><br></pre></td></tr></table></figure>
<blockquote>
<p>解决办法是登录到rabbitmq中把该交换机删掉就行了。</p>
</blockquote>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>Coding</tag>
        <tag>学习</tag>
      </tags>
  </entry>
  <entry>
    <title>MarkDown学习</title>
    <url>/2020/01/23/Markdown%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<p><em>xietiweiben</em><br><em>xietiwenben</em><br><u>带下划线文本</u></p>
<a id="more"></a>
<p>创建脚注格式类似这样 [^RUNOOB][^222]</p>
<p>[^RUNOOB]: 菜鸟教程 – 学的不仅是技术，更是梦想！！！<br>[^222]:2222</p>
<ol>
<li>diyixiang：<ul>
<li>第一项嵌套的第一个元素</li>
<li>第一项嵌套的第二个元素</li>
</ul>
</li>
<li>dierxiang：<ul>
<li>第二项嵌套的第一个元素</li>
</ul>
</li>
<li>disanxiang：<ul>
<li>第三项嵌套的第一个元素</li>
</ul>
</li>
</ol>
<blockquote>
<p>区块引用<br>菜鸟教程<br>学的不仅是技术更是梦想</p>
</blockquote>
<blockquote>
<p>最外层</p>
<blockquote>
<p>第一次嵌套</p>
<blockquote>
<p>第二次嵌套</p>
</blockquote>
</blockquote>
</blockquote>
<ul>
<li><p>第一项</p>
<blockquote>
<p>菜鸟教程<br>学的不仅是技术更是梦想</p>
</blockquote>
</li>
<li><p>第二项</p>
<blockquote>
<p><code>System.out.println()</code>方法</p>
</blockquote>
<blockquote>
<p>代码如下</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line">$(document).ready(function () &#123;</span><br><span class="line">alert(<span class="string">'RUNOOB'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>第三项</p>
<blockquote>
<p>非常推荐去<a href="https://www.leetcode.com" target="_blank" rel="noopener">leetcode</a>上刷题<br>  这是一个链接<a href="https://www.runoob.com" target="_blank" rel="noopener">https://www.runoob.com</a></p>
</blockquote>
<blockquote>
<p>链接也可以用变量代替，文档末尾附带变量地址:<br>  这个链接用1作为网址变量[Google][1]<br>  这个链接用 runoob 作为网址变量 [Runoob][runoob]<br>  然后在文档的结尾为变量赋值（网址）</p>
</blockquote>
</li>
</ul>
<pre><code>[1]: http://www.google.com/
[runoob]: http://www.runoob.com/</code></pre>]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>Coding</tag>
        <tag>学习</tag>
      </tags>
  </entry>
</search>
